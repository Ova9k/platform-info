image: golang:latest

before_script:
  - git config --global http.proxy "http://proxy-us.intel.com:911"
  - echo "[http \"https://gitlab.devtools.intel.com\"]" >> ~/.gitconfig
  - echo "        proxy = \"\"" >> ~/.gitconfig
  - cd $CI_PROJECT_DIR

stages:
  - build
  - test

test:
  stage: test
  tags:
    - go
  script:
    - echo "Acquire::http::Proxy \"http://proxy-us.intel.com:911\"" >> /etc/apt/apt.conf
    - echo "Acquire::https::Proxy \"https://proxy-us.intel.com:911\"" >> /etc/apt/apt.conf
    - apt-get update && apt-get install dmidecode
    - go test -cover

compile:
  stage: build
  tags:
    - go
  script:
    - go build ./...